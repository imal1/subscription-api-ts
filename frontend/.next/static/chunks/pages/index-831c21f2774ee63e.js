(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3144)}])},3144:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var a=t(5893),n=t(7294);function c(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join(" ")}let r=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("rounded-lg border border-gray-200 bg-white text-gray-900 shadow-sm",t),...n})});r.displayName="Card";let l=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let i=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:s,className:c("text-2xl font-semibold leading-none tracking-tight",t),...n})});i.displayName="CardTitle";let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:s,className:c("text-sm text-gray-600",t),...n})});d.displayName="CardDescription";let x=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("p-6 pt-0",t),...n})});x.displayName="CardContent",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter";let o=n.forwardRef((e,s)=>{let{className:t,variant:n="default",size:r="default",...l}=e;return(0,a.jsx)("button",{className:c("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-red-600 text-white hover:bg-red-700",outline:"border border-gray-300 bg-white text-gray-900 hover:bg-gray-50",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"text-gray-900 hover:bg-gray-100",link:"text-blue-600 underline-offset-4 hover:underline"}[n],{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}[r],t),ref:s,...l})});o.displayName="Button";class m{async request(e,s){try{let t=await fetch("".concat("").concat(e),{headers:{"Content-Type":"application/json",...null==s?void 0:s.headers},...s});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));return await t.json()}catch(s){throw console.error("API请求失败: ".concat(e),s),s}}async getStatus(){return this.request("/api/status")}async updateSubscription(){return this.request("/api/update")}async getHealth(){return this.request("/health")}async getConfigs(){return(await this.request("/api/configs")).data||[]}async diagnoseClash(){return this.request("/api/diagnose/clash")}getDownloadUrl(e){return"".concat("","/").concat(e)}}let h=new m;var j=t(1954);let u=e=>{let{title:s,value:t,description:n,icon:c,status:d="info"}=e;return(0,a.jsxs)(r,{className:"".concat({success:"text-green-600 bg-green-50 border-green-200",error:"text-red-600 bg-red-50 border-red-200",warning:"text-yellow-600 bg-yellow-50 border-yellow-200",info:"text-blue-600 bg-blue-50 border-blue-200"}[d]," transition-all hover:shadow-md"),children:[(0,a.jsxs)(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i,{className:"text-sm font-medium",children:s}),c]}),(0,a.jsxs)(x,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t}),n&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:n})]})]})};var p=()=>{var e;let[s,t]=(0,n.useState)(null),[c,m]=(0,n.useState)(!0),[p,N]=(0,n.useState)(!1),[f,g]=(0,n.useState)(null),[b,w]=(0,n.useState)(null),v=async()=>{try{g(null);let e=await h.getStatus();t(e)}catch(e){g(e instanceof Error?e.message:"获取状态失败")}finally{m(!1)}},y=async()=>{N(!0),w(null);try{let e=await h.updateSubscription();w(e),await v()}catch(e){g(e instanceof Error?e.message:"更新失败")}finally{N(!1)}},C=e=>{let s=h.getDownloadUrl(e);window.open(s,"_blank")};(0,n.useEffect)(()=>{v();let e=setInterval(v,3e4);return()=>clearInterval(e)},[]);let k=e=>{if(0===e)return"0 B";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["B","KB","MB","GB"][s]},E=e=>new Date(e).toLocaleString("zh-CN");return c?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:loading",className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"加载中..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Subscription API Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600",children:"TypeScript 订阅转换服务控制面板"})]}),f&&(0,a.jsx)(r,{className:"mb-6 border-red-200 bg-red-50",children:(0,a.jsxs)(x,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-600",children:[(0,a.jsx)(j.JO,{icon:"mdi:alert-circle",className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"错误"})]}),(0,a.jsx)("p",{className:"text-red-700 mt-2",children:f})]})}),b&&(0,a.jsx)(r,{className:"mb-6 ".concat(b.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:(0,a.jsxs)(x,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(b.success?"text-green-600":"text-red-600"),children:[b.success?(0,a.jsx)(j.JO,{icon:"mdi:check-circle",className:"w-5 h-5"}):(0,a.jsx)(j.JO,{icon:"mdi:close-circle",className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"更新结果"})]}),(0,a.jsx)("p",{className:"mt-2 ".concat(b.success?"text-green-700":"text-red-700"),children:b.message}),b.errors&&b.errors.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-red-600",children:"错误详情："}),(0,a.jsx)("ul",{className:"text-sm text-red-700 mt-1",children:b.errors.map((e,s)=>(0,a.jsxs)("li",{children:["• ",e]},s))})]})]})}),(0,a.jsxs)(r,{className:"mb-6",children:[(0,a.jsxs)(l,{children:[(0,a.jsxs)(i,{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:lightning-bolt",className:"w-5 h-5"}),(0,a.jsx)("span",{children:"快速操作"})]}),(0,a.jsx)(d,{children:"常用功能的快速入口"})]}),(0,a.jsx)(x,{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsxs)(o,{onClick:y,disabled:p,className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:p?"mdi:loading":"mdi:refresh",className:"w-4 h-4 ".concat(p?"animate-spin":"")}),(0,a.jsx)("span",{children:p?"更新中...":"更新订阅"})]}),(0,a.jsxs)(o,{variant:"outline",onClick:()=>C("subscription.txt"),className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:download",className:"w-4 h-4"}),(0,a.jsx)("span",{children:"下载订阅文件"})]}),(0,a.jsxs)(o,{variant:"outline",onClick:()=>C("clash.yaml"),className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:download",className:"w-4 h-4"}),(0,a.jsx)("span",{children:"下载Clash配置"})]}),(0,a.jsxs)(o,{variant:"outline",onClick:()=>C("raw.txt"),className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:download",className:"w-4 h-4"}),(0,a.jsx)("span",{children:"下载原始链接"})]}),(0,a.jsxs)(o,{variant:"outline",onClick:v,className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:refresh",className:"w-4 h-4"}),(0,a.jsx)("span",{children:"刷新状态"})]})]})})]}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,a.jsx)(u,{title:"订阅文件",value:s.subscriptionExists?"✅ 已生成":"❌ 未生成",description:s.subscriptionExists&&s.subscriptionLastUpdated?"更新于 ".concat(E(s.subscriptionLastUpdated)):"需要更新订阅",icon:(0,a.jsx)(j.JO,{icon:"mdi:file-document",className:"w-4 h-4"}),status:s.subscriptionExists?"success":"error"}),(0,a.jsx)(u,{title:"Clash 配置",value:s.clashExists?"✅ 已生成":"❌ 未生成",description:s.clashExists&&s.clashLastUpdated?"更新于 ".concat(E(s.clashLastUpdated)):"需要更新订阅",icon:(0,a.jsx)(j.JO,{icon:"mdi:shield-check",className:"w-4 h-4"}),status:s.clashExists?"success":"error"}),(0,a.jsx)(u,{title:"节点数量",value:s.nodesCount||0,description:"当前可用节点数",icon:(0,a.jsx)(j.JO,{icon:"mdi:account-group",className:"w-4 h-4"}),status:s.nodesCount&&s.nodesCount>0?"success":"warning"}),(0,a.jsx)(u,{title:"服务运行时间",value:(e=s.uptime,"".concat(Math.floor(e/3600),"小时 ").concat(Math.floor(e%3600/60),"分钟")),description:"当前服务实例运行时间",icon:(0,a.jsx)(j.JO,{icon:"mdi:clock-outline",className:"w-4 h-4"}),status:"info"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)(r,{children:[(0,a.jsxs)(l,{children:[(0,a.jsxs)(i,{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:server",className:"w-5 h-5"}),(0,a.jsx)("span",{children:"服务状态"})]}),(0,a.jsx)(d,{children:"依赖服务的运行状态"})]}),(0,a.jsx)(x,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Subconverter"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[s.subconverterRunning?(0,a.jsx)(j.JO,{icon:"mdi:check-circle",className:"w-4 h-4 text-green-600"}):(0,a.jsx)(j.JO,{icon:"mdi:close-circle",className:"w-4 h-4 text-red-600"}),(0,a.jsx)("span",{className:"text-sm ".concat(s.subconverterRunning?"text-green-600":"text-red-600"),children:s.subconverterRunning?"运行中":"离线"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Sing-box"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[s.singBoxAccessible?(0,a.jsx)(j.JO,{icon:"mdi:check-circle",className:"w-4 h-4 text-green-600"}):(0,a.jsx)(j.JO,{icon:"mdi:close-circle",className:"w-4 h-4 text-red-600"}),(0,a.jsx)("span",{className:"text-sm ".concat(s.singBoxAccessible?"text-green-600":"text-red-600"),children:s.singBoxAccessible?"可访问":"不可访问"})]})]})]})})]}),(0,a.jsxs)(r,{children:[(0,a.jsxs)(l,{children:[(0,a.jsxs)(i,{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:chart-line",className:"w-5 h-5"}),(0,a.jsx)("span",{children:"文件信息"})]}),(0,a.jsx)(d,{children:"生成文件的详细信息"})]}),(0,a.jsx)(x,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[s.subscriptionExists&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"订阅文件大小"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s.subscriptionSize?k(s.subscriptionSize):"N/A"})]}),s.clashExists&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Clash 文件大小"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s.clashSize?k(s.clashSize):"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"API 版本"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s.version})]})]})})]})]}),(0,a.jsxs)(r,{children:[(0,a.jsxs)(l,{children:[(0,a.jsxs)(i,{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.JO,{icon:"mdi:earth",className:"w-5 h-5"}),(0,a.jsx)("span",{children:"API 接口文档"})]}),(0,a.jsx)(d,{children:"可用的 API 端点和使用说明"})]}),(0,a.jsx)(x,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left p-2",children:"方法"}),(0,a.jsx)("th",{className:"text-left p-2",children:"端点"}),(0,a.jsx)("th",{className:"text-left p-2",children:"描述"}),(0,a.jsx)("th",{className:"text-left p-2",children:"操作"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"GET"})}),(0,a.jsx)("td",{className:"p-2 font-mono",children:"/api/status"}),(0,a.jsx)("td",{className:"p-2",children:"获取服务状态"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)(o,{variant:"outline",size:"sm",onClick:()=>window.open("/api/status","_blank"),children:"测试"})})]}),(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"GET"})}),(0,a.jsx)("td",{className:"p-2 font-mono",children:"/api/update"}),(0,a.jsx)("td",{className:"p-2",children:"更新订阅"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)(o,{variant:"outline",size:"sm",onClick:y,children:"执行"})})]}),(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"GET"})}),(0,a.jsx)("td",{className:"p-2 font-mono",children:"/subscription.txt"}),(0,a.jsx)("td",{className:"p-2",children:"下载订阅文件"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)(o,{variant:"outline",size:"sm",onClick:()=>C("subscription.txt"),children:"下载"})})]}),(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"GET"})}),(0,a.jsx)("td",{className:"p-2 font-mono",children:"/clash.yaml"}),(0,a.jsx)("td",{className:"p-2",children:"下载 Clash 配置"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)(o,{variant:"outline",size:"sm",onClick:()=>C("clash.yaml"),children:"下载"})})]}),(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"GET"})}),(0,a.jsx)("td",{className:"p-2 font-mono",children:"/raw.txt"}),(0,a.jsx)("td",{className:"p-2",children:"下载原始链接"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)(o,{variant:"outline",size:"sm",onClick:()=>C("raw.txt"),children:"下载"})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"GET"})}),(0,a.jsx)("td",{className:"p-2 font-mono",children:"/health"}),(0,a.jsx)("td",{className:"p-2",children:"健康检查"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)(o,{variant:"outline",size:"sm",onClick:()=>window.open("/health","_blank"),children:"测试"})})]})]})]})})})]})]})]})})};function N(){return(0,a.jsx)(p,{})}}},function(e){e.O(0,[954,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);